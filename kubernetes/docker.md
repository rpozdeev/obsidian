---
tags:
  - docker
---
# Docker

## Пространства имен (namespaces) в ядре Linux

1. **PID (Process ID namespace)**
	- Изолирует процессы, позволяя контейнеру иметь собственное дерево процессов.
	- Внутри контейнера процессы имеют PID, начиная с 1 (аналогично init-процессу в системе).
	- Контейнеры не видят процессы друг друга.
```bash
# внутри контейнера 
ps -aux

# на хосте
ps -e --forest
```

2. **NET (Network namespace)**
	-  Изолирует сетевые интерфейсы, IP-адреса, маршруты и брандмауэры.
	-  Каждый контейнер имеет собственный сетевой стек.
	-  Поддерживаются виртуальные интерфейсы (veth), мосты (bridge) и оверлейные сети.
```bash
ip addr
```

3. **IPC (Inter-Process Communication namespace)**
	- Изолирует механизмы межпроцессного взаимодействия: очереди сообщений, разделяемую память (SHM) и семафоры.
	- Обеспечивает безопасность данных при использовании общего хранилища между процессами.
```bash
# покажет сколько ресурсов доступно внетри контейнера
ipcs -m
```

4. **MNT (Mount namespace)**
- Изолирует файловую систему (точки монтирования).
- Контейнеры имеют собственное корневое файловое дерево.
- Изменения внутри контейнера не влияют на файловую систему хоста.
```bash
# посмотреть точки монтирования в контейнере
mount | grep overlay
```

5. **UTS (Unix Time-Sharing namespace)**
- Изолирует информацию о хосте, включая имя узла (hostname) и доменное имя (NIS).
- Контейнеры могут иметь свои собственные имена.
```bash
hostnamectl set-hostname mycontainer
```

6. **USER (User namespace)**
- Изолирует учетные записи пользователей и идентификаторы (UID и GID).
- Позволяет запускать процессы с привилегиями root внутри контейнера, но без прав root на хосте.
- Улучшает безопасность, сопоставляя привилегированные процессы с непривилегированными на хосте.
```bash
dockerd --userns-remap=default
```

7. **CGROUP (Control Groups namespace)**
- Изолирует и ограничивает ресурсы контейнера (CPU, память, дисковое пространство).
- Используется для контроля потребления ресурсов и предотвращения “захвата” всей мощности хоста.
```bash
docker run -m 512m nginx
```

### Проверка пространств имен на хосте

Увидеть пространства имен контейнера
```bash
lsns
```

Посмотреть PID namespace конкретного контейнера
```bash
docker inspect -f '{{.State.Pid}}' mycontainer
```

## Сеть

### Основные сетевые драйверы Docker

|**Драйвер**|**Описание**|**Использование**|
|---|---|---|
|bridge|Создаёт виртуальный мост между контейнерами на одном хосте|Изолированные среды по умолчанию|
|host|Использует сетевой стек хоста без изоляции|Высокая производительность при отсутствии изоляции|
|none|Не создаёт сетевого интерфейса|Полная изоляция от сети|
|overlay|Соединяет контейнеры между разными хостами через виртуальную сеть|Используется в кластерах Docker Swarm и Kubernetes|
|macvlan|Прямое подключение контейнера к физической сети через виртуальный MAC-адрес|Прямой доступ к внешней сети|
|ipvlan|Похож на macvlan, но использует IP-адреса вместо MAC-адресов|Подходит для сетей с ограничением на количество MAC|
|custom|Пользовательские плагины через API|Расширенные настройки и интеграции|
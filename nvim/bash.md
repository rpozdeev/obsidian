# Bash

Bash (Bourne Again SHell) — это командная оболочка в Unix/Linux, которая позволяет выполнять команды, писать скрипты и автоматизировать задачи.
## Основы синтаксиса

### Переменные
```bash
name="Алексей"
echo "Привет, $name!"
```

### Ввод данных
```bash
echo "Как тебя зовут?"
read name
echo "Привет, $name!"
```

### Арифметические операции
```bash
a=5
b=3
sum=$((a + b))
echo "Сумма: $sum"
```

### Условные операторы
```bash
if [ $a -gt $b ]; then
    echo "$a больше $b"
else
    echo "$a не больше $b"
fi
```

#### Проверки чисел (`-eq`, `-ne`, `-gt`, `-lt`, `-ge`, `-le`)

Используются внутри `[ ]` или `[[ ]]`

| Оператор | Пример           | Описание              | \[[ ]] |
| -------- | ---------------- | --------------------- | ------ |
| `-eq`    | `[ "$a" -eq 5 ]` | равно (equal)         | =, ==  |
| `-ne`    | `[ "$a" -ne 5 ]` | не равно (not equal)  | !=     |
| `-gt`    | `[ "$a" -gt 5 ]` | больше (greater than) | >      |
| `-lt`    | `[ "$a" -lt 5 ]` | меньше (less than)    | <      |
| `-ge`    | `[ "$a" -ge 5 ]` | больше или равно (≥)  | >=     |
| `-le`    | `[ "$a" -le 5 ]` | меньше или равно (≤)  | <=     |
**Пример:**
```bash
a=10
if [ "$a" -gt 5 ]; then
    echo "$a больше 5"
fi
if [[ "$a" > 5 ]]; then
    echo "$a больше 5"
fi
```

#### Проверки строк (`=`, `!=`, `-z`, `-n`)

|Оператор|Пример|Описание|
|---|---|---|
|`=`|`[ "$str" = "hello" ]`|строки равны|
|`!=`|`[ "$str" != "hello" ]`|строки не равны|
|`-z`|`[ -z "$str" ]`|строка пустая (zero length)|
|`-n`|`[ -n "$str" ]`|строка не пустая|
**Пример:**
```bash
name="Alice"
if [ "$name" = "Alice" ]; then
    echo "Привет, Алиса!"
fi
```

#### Проверки файлов и директорий

| Оператор | Пример               | Описание                    |
| -------- | -------------------- | --------------------------- |
| `-e`     | `[ -e "file.txt" ]`  | файл/директория существует  |
| `-f`     | `[ -f "file.txt" ]`  | это обычный файл (не папка) |
| `-d`     | `[ -d "dir" ]`       | это директория              |
| `-s`     | `[ -s "file.txt" ]`  | файл не пустой (size > 0)   |
| `-r`     | `[ -r "file.txt" ]`  | файл доступен для чтения    |
| `-w`     | `[ -w "file.txt" ]`  | файл доступен для записи    |
| `-x`     | `[ -x "script.sh" ]` | файл исполняемый            |
| `-L`     | `[ -L "link" ]`      | это символическая ссылка    |
**Пример:**
```bash
if [ -f "/etc/passwd" ]; then
    echo "Файл существует"
fi

if [! -f "/etc/passwd.bkp" ]; then
    echo "Файл не существует"
fi
```

#### Логические операторы (`&&`, `||`, `!`)

|Оператор|Пример (`[ ]`)|Альтернатива (`[[ ]]`)|Описание|
|---|---|---|---|
|`&&`|`[ "$a" -gt 1 ] && [ "$b" -lt 10 ]`|`[[ "$a" -gt 1 && "$b" -lt 10 ]]`|И (AND)|
|\|\||[ "$a" -eq 0 ]\|\|[ "$b" -eq 0 ]|`[[ "$a" -eq 0 \| "$b" -eq 0 ]]`|ИЛИ (OR)|
|`!`|`[ ! "$a" -eq 5 ]`|`[[ ! "$a" -eq 5 ]]`|НЕ (NOT)|
**Пример:**
```bash
if [[ -f "file.txt" && -r "file.txt" ]]; then
    echo "Файл существует и доступен для чтения"
fi
```

#### Комбинированные условия (`-a`, `-o`)
(Работают только в `[ ]`, в `[[ ]]` используй `&&` и `||`!)

| Оператор | Пример (`[ ]`)                  | Описание |
| -------- | ------------------------------- | -------- |
| `-a`     | `[ "$a" -gt 1 -a "$b" -lt 10 ]` | И (AND)  |
| `-o`     | `[ "$a" -eq 0 -o "$b" -eq 0 ]`  | ИЛИ (OR) |
**Пример:**
```bash
if [ "$age" -ge 18 -a "$country" = "RU" ]; then
    echo "Доступ разрешён"
fi
```

#### Проверки с `[[ ]]` (расширенные)

`[[ ]]` поддерживает:
- **Регулярные выражения** (`=~`) 
- **Сравнение строк без кавычек**
- **Более безопасную обработку переменных**

**Пример с `=~` (регулярные выражения)**
```bash
email="user@example.com"
if [[ "$email" =~ ^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$ ]]; then
    echo "Email валиден"
fi
```

### Циклы
#### for
```bash
for i in 1 2 3 4 5; do
    echo "Число: $i"
done
```

#### while
```bash
counter=0
while [[ $counter < 5 ]]; do
    echo "Счёт: $counter"
    ((counter++))
done
```

### Параметры командной строки

```bash
#!/bin/bash
echo "Первый аргумент: $1"
echo "Второй аргумент: $2"
```

```bash
./script.sh аргумент1 аргумент2

Первый аргумент: аргумент1
Второй аргумент: аргумент2
```

### Функции

```bash
greet() {
    echo "Привет, $1!"
}

greet "Мир"  # Вызов функции
```

### Работа с файлами

#### Проверить, существует ли файл:

```bash
if [ -f "file.txt" ]; then
    echo "Файл существует!"
else
    echo "Файл не найден."
fi
```

#### Чтение файла построчно:

```bash
while read line; do
    echo "Строка: $line"
done < file.txt
```

### Переменные для аргументов

Bash автоматически сохраняет переданные параметры в специальные переменные:

|Переменная|Описание|Пример (`./script.sh a b c`)|
|---|---|---|
|`$0`|Имя скрипта|`./script.sh`|
|`$1`, `$2`, ...|Позиционные аргументы (1-й, 2-й...)|`$1="a"`, `$2="b"`|
|`$#`|Количество аргументов|`3`|
|`$@`|Все аргументы как массив|`("a" "b" "c")`|
|`$*`|Все аргументы как одна строка|`"a b c"`|
#### Проверка наличия аргументов
##### Простая проверка (`if [ -z ... ]`)
```bash
if [ -z "$1" ]; then
    echo "Ошибка: не указан аргумент!"
    exit 1
fi
```
##### Проверка количества (`$#`)
```bash
if [ "$#" -lt 2 ]; then
    echo "Нужно 2 аргумента, получено: $#"
    exit 1
fi
```

#### Обработка ключей (`-f`, `--help`)

Для сложных скриптов с опциями (`-i`, `--output`) используйте `getopts` (для коротких флагов) или `getopt` (для длинных).

##### `getopts` (простой способ)
Поддержка коротких опций (`-v`, `-f file`):

```bash
#!/bin/bash
while getopts "u:p:h" opt; do
    case $opt in
        u) username="$OPTARG" ;;
        p) password="$OPTARG" ;;
        h) echo "Использование: $0 -u USER -p PASS"; exit 0 ;;
        *) echo "Неизвестная опция: -$opt" >&2; exit 1 ;;
    esac
done

echo "User: $username, Pass: $password"
```

```bash
./script.sh -u admin -p 12345
```

##### `getopt` (длинные опции `--help`)

Установите `getopt` (если нет):
```bash
sudo apt install util-linux  # для Linux
```

```bash
#!/bin/bash
options=$(getopt -o u:p:h --long username:,password:,help -n "$0" -- "$@")
eval set -- "$options"

while true; do
    case "$1" in
        -u|--username) username="$2"; shift 2 ;;
        -p|--password) password="$2"; shift 2 ;;
        -h|--help) echo "Помощь: $0 --username NAME --password PASS"; exit 0 ;;
        --) shift; break ;;
        *) echo "Ошибка в аргументах!"; exit 1 ;;
    esac
done

echo "User: $username, Pass: $password"
```

```bash
./script.sh --username admin --password 12345
```